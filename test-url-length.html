<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Longueur URL - Facture</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 100%;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .url-test {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            word-break: break-all;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        
        .test-link {
            display: inline-block;
            padding: 10px 15px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
        }
        .test-link:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test Longueur URL - Facture</h1>
        
        <div class="url-test">
            <h2>üìè URL Actuelle (Longue)</h2>
            <div id="current-url"></div>
            <div id="current-result"></div>
            <a href="#" id="current-link" class="test-link" target="_blank">Tester URL Longue</a>
        </div>
        
        <div class="url-test">
            <h2>üìè URL Optimis√©e (Courte)</h2>
            <div id="optimized-url"></div>
            <div id="optimized-result"></div>
            <a href="#" id="optimized-link" class="test-link" target="_blank">Tester URL Courte</a>
        </div>
        
        <div class="url-test">
            <h2>üìä Comparaison</h2>
            <div id="comparison"></div>
        </div>
        
        <div class="url-test">
            <h2>üí° Recommandations</h2>
            <div id="recommendations"></div>
        </div>
    </div>

    <script>
        // Donn√©es de test
        const testData = {
            invoice: 'ENIXIS_20251028_34',
            name: 'Edem Cyrille SOSSOUVI',
            email: 'edemcyrille@gmail.com',
            phone: '+22893369070',
            service: 'üéì Formation Coaching Emploi',
            price: 30000,
            delivery: 'urgent',
            payment: 'USDT (TRC-20)'
        };
        
        // G√©n√©rer l'URL actuelle (longue)
        function generateCurrentUrl(data) {
            const baseUrl = 'https://enixis-corp.vercel.app/api/invoice';
            const params = new URLSearchParams({
                invoice: data.invoice,
                name: data.name,
                email: data.email,
                phone: data.phone,
                service: data.service,
                price: data.price.toString(),
                delivery: data.delivery,
                payment: data.payment
            });
            
            return `${baseUrl}?${params.toString()}`;
        }
        
        // G√©n√©rer une URL optimis√©e (courte)
        function generateOptimizedUrl(data) {
            const baseUrl = 'https://enixis-corp.vercel.app/api/invoice';
            // Utiliser seulement les param√®tres essentiels
            const params = new URLSearchParams({
                invoice: data.invoice,
                // Encoder les donn√©es dans un seul param√®tre
                data: btoa(JSON.stringify({
                    name: data.name,
                    email: data.email,
                    phone: data.phone,
                    service: data.service,
                    price: data.price,
                    delivery: data.delivery,
                    payment: data.payment
                }))
            });
            
            return `${baseUrl}?${params.toString()}`;
        }
        
        // Analyser une URL
        function analyzeUrl(url) {
            const analysis = {
                length: url.length,
                status: 'success',
                message: '',
                issues: []
            };
            
            // V√©rifier la longueur
            if (url.length > 2048) {
                analysis.status = 'error';
                analysis.issues.push('URL trop longue (>2048 caract√®res) - peut ne pas fonctionner sur certains navigateurs');
            } else if (url.length > 1024) {
                analysis.status = 'warning';
                analysis.issues.push('URL longue (>1024 caract√®res) - peut poser des probl√®mes sur certains appareils mobiles');
            }
            
            // V√©rifier les caract√®res sp√©ciaux
            const specialChars = url.match(/[^\w\-\.~:\/\?#\[\]@!\$&'\(\)\*\+,;=%]/g);
            if (specialChars && specialChars.length > 0) {
                analysis.issues.push(`Caract√®res sp√©ciaux d√©tect√©s: ${[...new Set(specialChars)].join(', ')}`);
            }
            
            // V√©rifier l'encodage
            const encodedChars = url.match(/%[0-9A-Fa-f]{2}/g);
            if (encodedChars && encodedChars.length > 10) {
                analysis.issues.push(`Beaucoup de caract√®res encod√©s (${encodedChars.length}) - peut causer des probl√®mes`);
            }
            
            if (analysis.issues.length === 0) {
                analysis.message = '‚úÖ URL optimale';
            } else {
                analysis.message = `${analysis.issues.length} probl√®me(s) d√©tect√©(s)`;
            }
            
            return analysis;
        }
        
        // Afficher les r√©sultats
        function displayResults() {
            const currentUrl = generateCurrentUrl(testData);
            const optimizedUrl = generateOptimizedUrl(testData);
            
            const currentAnalysis = analyzeUrl(currentUrl);
            const optimizedAnalysis = analyzeUrl(optimizedUrl);
            
            // URL actuelle
            document.getElementById('current-url').innerHTML = `
                <strong>URL:</strong><br>
                <code style="font-size: 12px; word-break: break-all;">${currentUrl}</code>
            `;
            
            document.getElementById('current-result').innerHTML = `
                <div class="result ${currentAnalysis.status}">
                    <strong>Longueur:</strong> ${currentAnalysis.length} caract√®res<br>
                    <strong>Statut:</strong> ${currentAnalysis.message}<br>
                    ${currentAnalysis.issues.length > 0 ? '<strong>Probl√®mes:</strong><ul>' + currentAnalysis.issues.map(issue => `<li>${issue}</li>`).join('') + '</ul>' : ''}
                </div>
            `;
            
            document.getElementById('current-link').href = currentUrl;
            
            // URL optimis√©e
            document.getElementById('optimized-url').innerHTML = `
                <strong>URL:</strong><br>
                <code style="font-size: 12px; word-break: break-all;">${optimizedUrl}</code>
            `;
            
            document.getElementById('optimized-result').innerHTML = `
                <div class="result ${optimizedAnalysis.status}">
                    <strong>Longueur:</strong> ${optimizedAnalysis.length} caract√®res<br>
                    <strong>Statut:</strong> ${optimizedAnalysis.message}<br>
                    ${optimizedAnalysis.issues.length > 0 ? '<strong>Probl√®mes:</strong><ul>' + optimizedAnalysis.issues.map(issue => `<li>${issue}</li>`).join('') + '</ul>' : ''}
                </div>
            `;
            
            document.getElementById('optimized-link').href = optimizedUrl;
            
            // Comparaison
            const reduction = ((currentUrl.length - optimizedUrl.length) / currentUrl.length * 100).toFixed(1);
            document.getElementById('comparison').innerHTML = `
                <div class="result info">
                    <strong>R√©duction de taille:</strong> ${reduction}%<br>
                    <strong>√âconomie:</strong> ${currentUrl.length - optimizedUrl.length} caract√®res<br>
                    <strong>URL actuelle:</strong> ${currentUrl.length} caract√®res<br>
                    <strong>URL optimis√©e:</strong> ${optimizedUrl.length} caract√®res
                </div>
            `;
            
            // Recommandations
            let recommendations = [];
            
            if (currentAnalysis.length > 1024) {
                recommendations.push('‚úÖ Utiliser l\'URL optimis√©e pour une meilleure compatibilit√© mobile');
            }
            
            if (currentAnalysis.issues.some(issue => issue.includes('caract√®res encod√©s'))) {
                recommendations.push('‚úÖ Encoder les donn√©es en Base64 pour √©viter les probl√®mes d\'encodage URL');
            }
            
            recommendations.push('‚úÖ Tester sur diff√©rents appareils et navigateurs');
            recommendations.push('‚úÖ Impl√©menter un syst√®me de liens courts si n√©cessaire');
            recommendations.push('‚úÖ Consid√©rer l\'utilisation de POST au lieu de GET pour les donn√©es importantes');
            
            document.getElementById('recommendations').innerHTML = `
                <ul>
                    ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                </ul>
            `;
        }
        
        // Initialisation
        window.addEventListener('load', function() {
            displayResults();
            console.log('üîç Test de longueur URL termin√©');
        });
    </script>
</body>
</html>