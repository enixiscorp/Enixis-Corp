<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test T√©l√©chargement Facture</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .btn {
            background: #28a745;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .btn:hover {
            background: #218838;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üß™ Test de T√©l√©chargement de Facture PDF</h1>
    
    <div class="test-section">
        <h2>Test avec donn√©es d'exemple</h2>
        <p>Ce test simule le t√©l√©chargement d'une facture avec des donn√©es d'exemple.</p>
        
        <button class="btn" onclick="testDownload()">üì• Tester T√©l√©chargement PDF</button>
        
        <div id="status" class="status info" style="display: none;">
            Statut du test...
        </div>
    </div>
    
    <div class="test-section">
        <h2>Liens de test vers l'API</h2>
        <p>Testez directement avec l'API de facture :</p>
        
        <a href="/api/invoice?invoice=TEST_20251029_01&name=Test%20Client&email=test@example.com&phone=%2B228123456789&service=Test%20Service&price=15000&delivery=standard&payment=Test%20Payment" 
           class="btn" target="_blank">
            üîó Ouvrir Facture Test
        </a>
        
        <a href="/api/invoice?invoice=ENIXIS_20251029_39&name=Edem%20Cyrille%20SOSSOUVI&email=edemcyrille%40gmail.com&phone=%2B22893369070&service=%E2%9C%8D%EF%B8%8F%20Cr%C3%A9ation%20de%20CV%20sur%20mesure%20%2B%20Lettre&price=14000&delivery=urgent&payment=Flooz" 
           class="btn" target="_blank">
            üîó Ouvrir Facture R√©elle
        </a>
    </div>
    
    <div class="test-section">
        <h2>Instructions de test</h2>
        <ol>
            <li>Cliquez sur "Tester T√©l√©chargement PDF" pour simuler la fonction</li>
            <li>Ou cliquez sur "Ouvrir Facture Test" pour tester avec l'API r√©elle</li>
            <li>Sur la page de facture, cliquez sur "üì• T√©l√©charger PDF"</li>
            <li>La bo√Æte d'impression devrait s'ouvrir</li>
            <li>Choisissez "Enregistrer au format PDF" comme destination</li>
            <li>Le fichier PDF devrait se t√©l√©charger</li>
        </ol>
    </div>

    <script>
        // Simulation de la fonction downloadInvoice pour test
        function downloadInvoice() {
            console.log('üî• Test - T√©l√©chargement PDF demand√©');
            
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status info';
            statusDiv.innerHTML = '‚è≥ Simulation du t√©l√©chargement PDF...';
            
            try {
                // Simuler le processus
                setTimeout(() => {
                    statusDiv.className = 'status info';
                    statusDiv.innerHTML = 'üìÑ Pr√©paration de l\'impression...';
                    
                    setTimeout(() => {
                        try {
                            // Tenter d'ouvrir la bo√Æte d'impression
                            window.print();
                            
                            statusDiv.className = 'status success';
                            statusDiv.innerHTML = '‚úÖ Bo√Æte d\'impression ouverte ! Choisissez "Enregistrer au format PDF"';
                            
                        } catch (error) {
                            statusDiv.className = 'status error';
                            statusDiv.innerHTML = '‚ùå Erreur : ' + error.message;
                        }
                    }, 1000);
                }, 500);
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = '‚ùå Erreur de simulation : ' + error.message;
            }
        }
        
        function testDownload() {
            downloadInvoice();
        }
        
        // Test de la fonction au chargement
        window.addEventListener('load', function() {
            console.log('‚úÖ Page de test charg√©e');
            console.log('üîç Fonction downloadInvoice disponible:', typeof downloadInvoice === 'function');
        });
    </script>
</body>
</html>